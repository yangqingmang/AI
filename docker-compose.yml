version: '3.8'

services:
  # 1. 独立的向量数据库服务端
  chroma-server:
    image: chromadb/chroma:latest
    container_name: chroma_server
    volumes:
      - ./chroma_db:/chroma/chroma
    ports:
      - "8000:8000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/v1/heartbeat"]
      interval: 10s
      timeout: 5s
      retries: 5

  # 2. 你的应用 (作为客户端)
  enterprise-brain:
    build: .
    image: enterprise-brain:v1.2
    container_name: enterprise_brain_v1
    restart: unless-stopped
    ports:
      - "8501:8501"
    volumes:
      - ./data:/app/data
    environment:
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - DEEPSEEK_BASE_URL=${DEEPSEEK_BASE_URL}
      - LLM_MODEL_NAME=${LLM_MODEL_NAME}
      - CHROMA_SERVER_HOST=chroma-server
      - CHROMA_SERVER_PORT=8000
    depends_on:
      chroma-server:
        condition: service_healthy
    deploy:
      resources:
        limits:
          memory: 4G

